{"tags":[{"name":"Leetcode","permalink":"http://www.smartyi8979.com/tags/Leetcode/","url":"/async/tags/Leetcode.json","count":75},{"name":"Google","permalink":"http://www.smartyi8979.com/tags/Google/","url":"/async/tags/Google.json","count":61},{"name":"算法","permalink":"http://www.smartyi8979.com/tags/算法/","url":"/async/tags/算法.json","count":76}],"categories":[{"name":"技术","permalink":"http://www.smartyi8979.com/categories/技术/","url":"/async/categories/技术.json","count":78}],"url":"/async/posts/2016/03/17/Find-Median-from-Data-Stream.json","date":1458246379000,"path":{"year":2016,"month":3,"day":17,"name":"Find-Median-from-Data-Stream"},"title":"Find Median from Data Stream","permalink":"http://www.smartyi8979.com/2016/03/17/Find-Median-from-Data-Stream/","content":"<h4 id=\"Problem\"><a href=\"#Problem\" class=\"headerlink\" title=\"Problem:\"></a>Problem:</h4><p>Median is the middle value in an ordered integer list. If the size of the list is even, there is no middle value. So the median is the mean of the two middle value.<br><a id=\"more\"></a></p>\n<blockquote>\n<p>Examples:<br>[2,3,4] , the median is 3<br>[2,3], the median is (2 + 3) / 2 = 2.5</p>\n</blockquote>\n<p>Design a data structure that supports the following two operations:</p>\n<ul>\n<li>void addNum(int num) - Add a integer number from the data stream to the data structure.</li>\n<li>double findMedian() - Return the median of all elements so far.</li>\n</ul>\n<blockquote>\n<p>For example:<br>add(1)<br>add(2)<br>findMedian() -&gt; 1.5<br>add(3)<br>findMedian() -&gt; 2</p>\n</blockquote>\n<h4 id=\"分析：\"><a href=\"#分析：\" class=\"headerlink\" title=\"分析：\"></a>分析：</h4><p>还记得之前我们做的找出两个有序数组的中位数吗？在那里我就提到了一种方法是利用heap来解决那个问题。当然对于那个问题来说最优解是二分查找，但对于这个的话，我们就必须使用最大最小堆了。<a href=\"http://smartyi8979.com/2016/03/15/Median-of-two-sorted-array/\" target=\"_blank\" rel=\"external\">请戳这里</a><br>顺带说一下最大最小堆：</p>\n<ul>\n<li>最大堆就是堆顶的元素是这个堆里面元素的最大值；</li>\n<li>那么最小堆就是堆顶元素是这个堆里面元素的最小值；</li>\n</ul>\n<p>思路和之前那个题目一样。</p>\n<p><strong>维护一个最大堆，一个最小堆。最大堆存的是到目前为止较小的那一半数，最小堆存的是到目前为止较大的那一半数，这样中位数只有可能是堆顶或者堆顶两个数的均值。而维护两个堆的技巧在于判断堆顶数和新来的数的大小关系，还有两个堆的大小关系。我们将新数加入堆后，要保证两个堆的大小之差不超过1。先判断堆顶数和新数的大小关系，有如下三种情况：</strong></p>\n<ul>\n<li>最小堆堆顶小于新数时，说明新数在所有数的上半部分;</li>\n<li>最小堆堆顶大于新数，但最大堆堆顶小于新数时，说明新数将处在最小堆堆顶或最大堆堆顶，也就是一半的位置;</li>\n<li>最大堆堆顶大于新数时，说明新数将处在所有数的下半部分;</li>\n</ul>\n<p><strong>再判断两个堆的大小关系，如果新数不在中间，那目标堆不大于另一个堆时，将新数加入目标堆，否则将目标堆的堆顶加入另一个堆，再把新数加入目标堆。如果新数在中间，那加到大小较小的那个堆就行了（一样大的话随便，代码中是加入最大堆）。这样，每次新加进来一个数以后，如果两个堆一样大，则中位数是两个堆顶的均值，否则中位数是较大的那个堆的堆顶。</strong></p>\n<p><strong><em>Java中实现最大堆是在初始化优先队列时加入一个自定义的Comparator，默认初始堆大小是11。Comparator实现compare方法时，用arg1 - arg0来表示大的值在前面</em></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MedianFinder</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//This problem needs two heaps, one is max heap and the other one is min heap</span></span><br><span class=\"line\">    PriorityQueue&lt;Integer&gt; maxHeap;</span><br><span class=\"line\">    PriorityQueue&lt;Integer&gt; minHeap;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MedianFinder</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        maxHeap = <span class=\"keyword\">new</span> PriorityQueue&lt;&gt;(<span class=\"keyword\">new</span> Comparator&lt;Integer&gt;()&#123;</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">compare</span><span class=\"params\">(Integer o1, Integer o2)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> o2 - o1;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        minHeap = <span class=\"keyword\">new</span> PriorityQueue&lt;&gt;();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// Adds a number into the data structure.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addNum</span><span class=\"params\">(<span class=\"keyword\">int</span> num)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (maxHeap.size() == <span class=\"number\">0</span> || num &lt;= maxHeap.peek()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (maxHeap.size() &gt; minHeap.size()) &#123;</span><br><span class=\"line\">                minHeap.offer(maxHeap.poll());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            maxHeap.offer(num);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (minHeap.size() == <span class=\"number\">0</span> || num &gt; minHeap.peek()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (minHeap.size() &gt; maxHeap.size()) &#123;</span><br><span class=\"line\">                maxHeap.offer(minHeap.poll());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            minHeap.offer(num);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (maxHeap.size() &lt;= minHeap.size()) &#123;</span><br><span class=\"line\">                maxHeap.offer(num);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                minHeap.offer(num);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Returns the median of current data stream</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">double</span> <span class=\"title\">findMedian</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> maxHeap.size() == minHeap.size() ? (maxHeap.peek() + minHeap.peek()) / <span class=\"number\">2.0</span> : </span><br><span class=\"line\">                                 (maxHeap.size() &gt; minHeap.size()) ? maxHeap.peek() : minHeap.peek();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>嗯，很难。</p>\n"}